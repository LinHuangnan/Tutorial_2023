# 基于STM32完成考核任务

Author：@LinHuangnan

Revise：

| 版本 | 说明 |备注|
| ---- | ---- | ---- |
| v0.0.0 | 建立文档 |无|
| v0.0.1 |  |  |

## 前言

首先说明学习STM32必须有C语言的基础，没有基础的话建议先学一下C语言

下面将介绍与STM32相关的一些概念

`嵌入式` 嵌入式即嵌入式系统，是用于控制、监视或者辅助操作机器和设备的装置，是一种专用的计算机系统，或者说是将微型计算机嵌入到电子产品内部，生活中看到的很多设备其实都是嵌入式系统，包括：空调、冰箱、洗衣机等家电，智能手机和智能手表和其他可穿戴智能硬件，摄像头、智能门锁等等

`单片机` 单片机也广泛称为`微控制器`（`MCU`），具有数据处理能力的中央处理器CPU、随机存储器RAM、只读存储器ROM、多种I/O口和中断系统、定时器/计数器等功能（可能还包括显示驱动电路、脉宽调制电路、模拟多路转换器、A/D转换器等电路）集成到一块硅片上构成的一个小而完善的微型计算机系统，简单来说就是独有一个芯片（本质上是芯片内独有一个半导体chip）的计算机系统，或者说是单个片（chip）上的计算机系统。粗略的划分单片机也属于嵌入式系统，因为很多嵌入式产品中被嵌入的计算机系统就是单片机

`微处理器` 微处理器就是我们通常说的CPU，这里不作讨论

`单片机的位数` 指CPU 一次能够处理的数据的宽度，或者参与运算的寄存器的数据长度，常见的8 bit单片机有51单片机，STM8等，常见的16 bit单片机有TI公司的MSP430/MSP432,常见的32 bit单片机有STM32等

`单片机的时钟频率` 时钟频率，通俗的说就是对单片机执行指令提供一个节拍，一般时钟频率越高，单片机处理数据的速度就越快

### 什么是STM32
#### STM32是什么
- ST 意法半导体，即SOC厂商
- M  Microelectronics的缩写，即微控制器
- 32 32bit，表示是一个32bit微控制器

通过上面的讨论，可以知道其实STM32就是一种数据宽度为32bit的单片机

#### 为什么选择STM32
选择STM32，主要是因为STM32控制方便、功能强大、高性能、低成本、低功耗
- STM32的外设资源丰富
- STM32基于库开发的方式降低了编程的难度
- 时钟频率高，速度快，比如F1系列的时钟频率达到72MHz，F4系列可以达到168MHz

### STM32的开发方式
STM32有三种常见的开发方式
- `直接配置寄存器` 你可能学过51单片机，直接操作寄存器是51单片机很常见的一种开发方式，但是这种方法到了STM32就变得不太容易行得通了，因为STM32的寄存器数量是51单片机的十数倍，如此多的寄存器根本无法全部记忆，开发时需要经常的翻查芯片的数据手册，此时直接操作寄存器就变得非常的费力了。但还是会有很小一部分人，喜欢去直接操作寄存器，因为这样更接近原理，知其然也知其所以然
- `标准库` ST公司为每款芯片都编写了一份库文件，也就是工程文件里stm32F1xx…之类的。在这些 .c .h文件中，包括一些常用量的宏定义，把一些外设也通过结构体变量封装起来，如GPIO口时钟等。所以我们只需要配置结构体变量成员就可以修改外设的配置寄存器，从而选择不同的功能。也是目前最多人使用的方式，也是学习STM32接触最多的一种开发方式
- `HAL库开发` HAL库是ST公司目前主力推的开发方式，全称就是Hardware Abstraction Layer（抽象印象层）。它的出现比标准库要晚，但其实和标准库一样，都是为了节省程序开发的时间，而且HAL库尤其的有效，如果说标准库把实现功能需要配置的寄存器集成了，那么HAL库的一些函数甚至可以做到某些特定功能的集成。也就是说，同样的功能，标准库可能要用几句话，HAL库只需用一句话就够了。并且HAL库也很好的解决了程序移植的问题，不同型号的stm32芯片它的标准库是不一样的，例如在F4上开发的程序移植到F3上是不能通用的，而使用HAL库，只要使用的是相通的外设，程序基本可以完全复制粘贴。而且使用HAL库开发可以配合使用ST公司研发的CubeMX软件，可以通过图形化的界面配置功能，直接生成整个使用HAL库的工程文件。

**这里建议入门时先学习标准库，~~因为标准库对于新手相对友好~~，而且CSDN上有很多的示例程序，大部分示例程序都很好移植**

**学习STM32还是应该注重实践，可以跟着立创开源广场，B站上面的教程，自己复现一些开源项目，完成一两个项目之后，差不多就能够比较好的掌握STM32的常用外设**

## 软件/工具 介绍
### STM32开发环境--Keil的介绍和安装
#### 什么是Keil
Keil是单片机的一款开发环境，分为不同的版本分别对应不同阶段的单片机，主流的就是51单片机和STM32单片机。

这里需要注意的是，一般来说51单片机和STM32单片机的Keil版本不能共用，也就是一个keil不能同时编译51和STM32单片机的程序。

#### Keil的安装
详细操作参考[这篇文章](https://blog.csdn.net/Matcha_ice_cream/article/details/118684582?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165993837416782425120440%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=165993837416782425120440&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-118684582-null-null.142^v39^pc_rank_v38,185^v2^control&utm_term=KEIL&spm=1018.2226.3001.4187)，可以说是属于保姆级教程了

### STM32图形化配置工具--CUBEMX的介绍和安装
#### 什么是CUBEMX
STM32CubeMX 是 ST 意法半导体近几年来大力推荐的STM32 芯片图形化配置工具，目的就是为了方便开发者， 允许用户使用图形化向导生成C 初始化代码，可以大大减轻开发工作，时间和费用，提高开发效率。STM32CubeMX几乎覆盖了STM32 全系列芯片。 在CubeMX上，通过傻瓜化的操作便能实现相关配置，最终能够生成C语言代码，支持多种工具链，比如MDK、IAR For ARM、TrueStudio等  省去了我们配置各种外设的时间，大大的节省了时间。

**如果采用HAL库开发一般会用到这个工具，如果仅仅只是学标准库开发的话，可以不用下载这个软件**

#### CUBEMX的安装
详细操作参考[这篇文章](https://strongerhuang.blog.csdn.net/article/details/52225736?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5-52225736-blog-98885316.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5-52225736-blog-98885316.pc_relevant_aa&utm_relevant_index=10),也是保姆级教程

## 需要掌握的内容

首先请先了解一下STM32的命名规则，有哪些系列，这里比较建议大家先学习F1系列，或者F4系列，这两种基本上可以满足大多数的应用场景

**很推荐大家自己买一块STM32F103C8T6最小系统板，~~或者去开放实验室（地点为北实验楼C301）嫖一块也不是不行~~**

一般来说刚刚入门的时候，都是从点亮第一个LED开始，然后学习花样点灯，成为点灯大师，~~然后就放弃了~~

这里总结一些常见的建议掌握的外设和知识点，可以按照下面的顺序来学习STM32

- `GPIO` 包括输入和输出，学完之后可以自己试着点灯，控制蜂鸣器，检测按键输入等等。
- `UART` 通用异步收发传输器,学完之后可以买一个USB转TTL模块，下载一个串口调试助手，与上位机进行串口通信实验，也可以买一给串口蓝牙模块，比如HC-05，同样可以进行通信实验
- `TIM`  定时器功能，STM32的定时器分为高级定时器和基本定时器，内容还是挺多的，比如基本的定时，输入捕获，输出PWM波等等，可以结合具体的实例学习，比如基本的定时可以触发中断，用来做按键 的长按，短按的扫描，输入捕获可以测量方波的频率，输出PWM可以用来驱动电机等等；
- `EXTI` 外部中断，可以用检测外部电平的变化，比如来做按键输入检测，按键按下就外部触发中断等等
- `ADC`  STM32有好几个内置的ADC，可以通过配置初始化结构体使ADC工作在不同的工作模式，比如连续转换，单次转换等等，这个功能有很多应用，特别是在信号处理方面，掌握了这个外设，可以自己试着做一个STM32简易仪器仪表，比如欧姆表，示波器等等，当然内置的ADC最高采样率只有1M左右，对高频信号还是得采用外置的ADC，通过I2C或者SPI与单片机通信；
- `DAC` 掌握了这个功能，可以试着做一个波形发生器
- `DMA` DMA可以进行数据的直接搬运，而不经过CPU，从而提高单片机的速度，DMA可以配合ADC，UART等外设来使用
- `I2C` I2C通信有很多应用场景，单片机与一些ADC芯片的通信就是采用I2C，有一种4脚的0.96寸的OLED，其与单片机的通信也是通过I2C
- `SPI` SPI通信也有很多应用场景，很多常用屏幕与单片机的数据交换都是采用SPI的方式
- `CAN` CAN通信常用在汽车等系统中，与M2006电机的通信也是CAN通信的方式
- `USB` STM32还提供了USB库，有兴趣也可以学习一下

## STM32F103C8T6介绍
参考[这篇文章](https://blog.csdn.net/fantastic_sky/article/details/110229474?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165993851716781647534722%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=165993851716781647534722&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-110229474-null-null.142^v39^pc_rank_v38,185^v2^control&utm_term=stm32f103c8t6&spm=1018.2226.3001.4187)

## STM32程序的烧录
比较常用，而且相对比较简单的是使用STLink进行程序的烧录，参考[这篇文章](https://blog.csdn.net/weixin_43732386/article/details/117375266?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5-117375266-blog-79316039.pc_relevant_multi_platform_whitelistv3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5-117375266-blog-79316039.pc_relevant_multi_platform_whitelistv3&utm_relevant_index=8)

## 推荐教程/参考资料
STM32 标准库教程推荐[B站上的这个教程](https://www.bilibili.com/video/BV1th411z7sn?share_source=copy_web&vd_source=34ed110d766ac5910b35ccc9afedda6e)

STM32 HAL库教程推荐[CSDN上的Z小旋的博客](https://blog.csdn.net/as480133937/category_9188655.html)

## 补充
**最后补充一点，学习STM32一定要学会移植示例程序，这样子可以节省很多时间**

**示例程序CSDN上面很多，输入自己需要使用的外设名称进行搜索，就能找到很多不错的例程**
